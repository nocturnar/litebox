(function(a,b){function d(a,b){var c,d=b[0],e=a.scale,f,h;c={width:d.naturalWidth||d.width,height:d.naturalHeight||d.height},a.resize&&(a.thumbnailSize={width:Math.floor(c.width*e),height:Math.floor(c.height*e)}),f={width:c.width*e+"px",height:c.height*e+"px"},h={width:c.width+"px",height:c.height+"px"},a.layout.centerX&&(f.left=Math.floor(c.width/2-a.thumbnailSize.width/2)*-1+parseInt(a.layout.centerX,10)*-1+"px",h.left=0),a.layout.centerY&&a.layout.height&&(f.top=Math.floor(c.height/2-a.thumbnailSize.height/2)*-1+parseInt(a.layout.centerY,10)*-1+"px",h.top=0),g(f).into(a.thumbnailImageStyle),g(h).into(a.fullImageStyle),b.css(f);return c}function c(a){return a.charAt(0)==="-"?a.slice(1):"-"+a}Litebox=function(a,g,h){var i=b(a),j=i.find("img"),k=j[0],l={};Litebox.lightboxes||(Litebox.lightboxes={}),i.attr("id")||i.attr("id","litebox"+e++),Litebox.lightboxes[i.attr("id")]=this,this.layer=a,this.pane=g;var m=h.duration;m&&(/^(\d|\.)+s$/.test(m)?m=parseFloat(m)*1e3:m=parseFloat(m),isNaN(m)||(this.duration=m));var n=h.scale;n&&(/^(\d)+%$/.test(n)?n=parseInt(n)/100:n=parseFloat(n),isNaN(n)||(this.scale=n));var o={},p={},q,r,s,t;if(h.layout){r=h.layout.split(";"),s=r.length;for(q=0;q<s;q++)t=r[q].split(":"),o[f.call(t[0])]=f.call(t[1])}this.layout=o,this.fullImageStyle={},this.thumbnailSize=l;var u=this.resize=!o.width&&!o.height;o.left&&(p.left=c(o.left)),o.right&&(p.right=c(o.right)),o.top&&(p.top=c(o.top)),o.bottom&&(p.bottom=c(o.bottom));for(var v in p)p.hasOwnProperty(v)&&(this.fullImageStyle[v]=0);this.thumbnailImageStyle=p,j.css(p);var w,x=this;k.complete?(o.width&&(l.width=parseInt(o.width,10)),o.height&&(l.height=parseInt(o.height,10)),this.imageSize=d(this,j),i.css(this.thumbnailSize),i.bind("click",function(){x.show.apply(x,arguments)})):k.onload=function(){x.imageSize=d(x,j),y.find("img").css({width:x.imageSize.width*x.scale+"px",height:x.imageSize.height*x.scale+"px"}),i.css(x.thumbnailSize),i.bind("click",function(){x.show.apply(x,arguments)})},i.keydown(function(a){a.which===13&&x.show();return!0});var y=i.clone();this.popupLayer=y[0]},Litebox.prototype={duration:500,scale:1,layout:null,resize:!0,thumbnailImageStyle:null,fullImageStyle:null,thumbnailSize:null,imageSize:null,layer:null,popupLayer:null,isAnimating:!1,isShowing:!1,show:function(){if(!this.isShowing){this.isShowing=!0;var c=b(this.layer),d=b(a),e=b(this.popupLayer),f=b(this.pane.layer),h,i,j={height:a.innerHeight?a.innerHeight:d.height(),width:a.innerWidth?a.innerWidth:d.width()},k=c.offset();i=g(this.thumbnailSize,{top:Math.floor(k.top)-d.scrollTop(),left:Math.floor(k.left)-d.scrollLeft()}).into({marginTop:"0px",marginLeft:"0px"}),h=g(this.imageSize).into({top:Math.floor(j.height/2)+"px",left:Math.floor(j.width/2)+"px",marginTop:-1*Math.floor(this.imageSize.height/2)+"px",marginLeft:-1*Math.floor(this.imageSize.width/2)+"px"}),e.css(i),f.append(e);var l=this;f.find(".litebox-modal-pane").bind("click",function(){l.hide.apply(l,arguments)}),e.bind("click",function(){l.hide.apply(l,arguments)}),this.pane.show(this.duration),d.keydown(l,this.keyDown),e.find("img").animate(this.fullImageStyle,this.duration),l.isAnimating=!0,e.animate(h,this.duration,function(){l.isAnimating=!1,e.addClass("active"),e.css({top:"50%",left:"50%"})})}},keyDown:function(a){a.which===27&&a.data.hide()},hide:function(){if(!!this.isShowing){var c=b(this.popupLayer),d=b(this.layer),e=b(this.pane.layer),f=b(a),h,i={height:a.innerHeight?a.innerHeight:f.height(),width:a.innerWidth?a.innerWidth:f.width()},j=this,k=d.offset();h=g(this.thumbnailSize,{top:Math.floor(k.top)-f.scrollTop(),left:Math.floor(k.left)-f.scrollLeft()}).into({marginTop:"0px",marginLeft:"0px"}),this.pane.hide(this.duration),c.removeClass("active"),this.isAnimating?(c.stop(),c.find("img").stop()):c.css({left:Math.floor(i.width/2)+"px",top:Math.floor(i.height/2)+"px"}),c.find("img").animate(this.thumbnailImageStyle,this.duration),f.unbind("keydown",this.keyDown),c.animate(h,this.duration,function(){j.isShowing=!1,c.remove(),c.unbind("click"),e.find(".litebox-modal-pane").unbind("click")})}}},Litebox.Pane=function(a){var c="pane-"+e++,d,f;b(a).append('<div class="litebox-pane" id="'+c+'">'+'<div class="litebox-modal-pane"></div>'+"</div>"),d=b("#"+c),f=d.children(),d.hide(),this._opacity=f.css("opacity"),this.layer=d[0]},Litebox.Pane.prototype={isAnimating:!1,hide:function(a){var c=this.layer,d=b(c),e=d.find(".litebox-modal-pane");this.isAnimating&&e.stop(),e.animate({opacity:0},a,function(){d.hide()})},show:function(a){var c=this.layer,d=b(c),e=d.find(".litebox-modal-pane"),f=this;f.isAnimating=!0,d.show(),e.css("opacity",0),e.animate({opacity:this._opacity},a,function(){f.isAnimating=!1})}};var e=0,f=String.prototype.trim||function(){var a=this.match(/\S+(?:\s+\S+)*/);return a?a[0]:""},g=function(){var a=arguments,b=0,c=a.length;return{into:function(d){var e,f;for(;b<c;b+=1){e=a[b];for(f in e)d[f]=e[f]}return d}}};b(document).ready(function(){var a=new Litebox.Pane(b("body")[0]);b(".litebox").each(function(c,d){new Litebox(d,a,b(d).data())})}),a.Litebox=Litebox})(this,$||jQuery)